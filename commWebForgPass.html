<!doctype html>
<html>
	<head>
		<title>Public Comm Service | Forgot Password</title>
		<link rel="stylesheet" href=./commWeb.css>
		<link rel="shortcut icon" href=./commWebLogo.png>
		<!-- The core Firebase JS SDK is always required and must be listed first -->
		<script type="text/javascript" async="" src="https://www.googletagmanager.com/gtag/js?id=G-0LLEX8LB45&amp;l=dataLayer&amp;cx=c"></script><script src="https://www.gstatic.com/firebasejs/7.4.0/firebase-app.js"></script>

		<!-- TODO: Add SDKs for Firebase products that you want to use
		     https://firebase.google.com/docs/web/setup#available-libraries -->
		<script src="https://www.gstatic.com/firebasejs/7.4.0/firebase-analytics.js"></script>

		<script src="https://www.gstatic.com/firebasejs/5.9.1/firebase-auth.js"></script>

		<script src="https://www.gstatic.com/firebasejs/7.4.0/firebase-database.js"></script>

		<script>
		  // Your web app's Firebase configuration
		  const firebaseConfig = {
			  apiKey: "AIzaSyA9xW50xSHA5QrL7ot3i8eX1FXcdxyEKxE",
			  authDomain: "public-communication-service.firebaseapp.com",
			  databaseURL: "https://public-communication-service.firebaseio.com",
			  projectId: "public-communication-service",
			  storageBucket: "public-communication-service.appspot.com",
			  messagingSenderId: "465965669190",
			  appId: "1:465965669190:web:addda9e3523c2c6dba2347",
			  measurementId: "G-0LLEX8LB45"
			};
		  // Initialize Firebase
		  firebase.initializeApp(firebaseConfig);
		  firebase.analytics();
		  // Sign in
		  const auth = firebase.auth();
		  data = firebase.database();
		</script><script src="https://www.googletagmanager.com/gtag/js?l=dataLayer" async=""></script>
		<script src=./commWebForgPass.js></script>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
		<script src="http://www.skulpt.org/js/skulpt.min.js"></script>
		<script src="http://www.skulpt.org/js/skulpt-stdlib.js"></script>
		<script>
			function outf(text) { 
			    console.log(text)
			} 
			function builtinRead(x) {
			    if (Sk.builtinFiles === undefined || Sk.builtinFiles["files"][x] === undefined)
				    throw "File not found: '" + x + "'";
			    return Sk.builtinFiles["files"][x];
			}
			function runit() { 
			   var prog = "def forgPassEmail(TO, USER, TOKEN):
			    import smtplib
			    from email.mime.multipart import MIMEMultipart
			    from email.mime.text import MIMEText
			    server = smtplib.SMTP('smtp.gmail.com')
			    server.starttls()
			    server.login('publiccommserv@gmail.com', 'imndubaghlyovusx')
			    MESSAGE = MIMEMultipart('alternative')
			    MESSAGE['Subject'] = 'Reset Password | PCS Help'
			    MESSAGE['From'] = 'publiccommserv@gmail.com'
			    MESSAGE['To'] = TO
			    buttonStyle = """
			font: bold 11px Arial;
			text-decoration: none;
			background-color: #EEEEEE;
			color: #333333;
			padding: 2px 6px 2px 6px;
			border-top: 1px solid #CCCCCC;
			border-right: 1px solid #333333;
			border-bottom: 1px solid #333333;
			border-left: 1px solid #CCCCCC;
			border-radius: 4px;
			"""
			    text =  MIMEText(f'''\
			<html>
			    <body>
				<p>Dear {USER},</p>
				<br>
				<br>
				<p>You have requested a password reset link. If you do not\
			 recognize this username or you have not requested a password reset, please\
			 delete this email.</p>
				<br>
				<center>
				    <p>To reset your password click this button:<br><br>
			<a style="{buttonStyle}" href="https://malcolm07.github.io/Public-Communication-Service/commWebResetPass.html?user={TOKEN}">\
			Reset Password</a><br><br>WARNING: After 24 hours, this link will not be usable!</p>
				</center>
				<br>
				<br>
				<p>From PCS Help</p>
			    </body>
			</html>
			''', 'html')
			    MESSAGE.attach(text)
			    server.sendmail('publiccommserv@gmail.com', TO, MESSAGE.as_string())
			    server.quit()";
			   Sk.pre = "output";
			   Sk.configure({output:outf, read:builtinRead}); 
			   (Sk.TurtleGraphics || (Sk.TurtleGraphics = {})).target = 'mycanvas';
			   var myPromise = Sk.misceval.asyncToPromise(function() {
			       return Sk.importMainWithBody("<stdin>", false, prog, true);
			   });
			   myPromise.then(function(mod) {
			       console.log('success');
			   },
			       function(err) {
			       console.log(err.toString());
			   });
			} 
			
		</script>
	</head>
	<body>
		<ul class="navBar">
			<li><a href="./index.html" class="notFilledIn">Home</a></li>
			<li><a href="./commWebLogin.html" class="notFilledIn">Log In</a></li>
			<li><a href="./commWebSignup.html" class="notFilledIn">Sign Up</a></li>
			<li><a href="./commWebContact.html" class="notFilledIn">Contact Us</a></li>
			<li><img src="./commWebLogo.png" class="logo" alt="Public Communication Service Logo"></li>
		</ul>
		<div class="input" id="input">
			<h2 class="center" id="forgPassTitle">Forgot Password</h2>
			<table>
				<tbody><tr>
					<td class="label"><label id="usernameLabel">Username</label></td>
				</tr>
				<tr>
					<td><input type="text" id="username" placeholder="BobTheBob"></td>
				</tr>
				<tr>
					<td class="error"><label id="usernameError"></label></td>
				</tr>
				<tr>
					<td class="label"><label id="emailLabel">Email</label></td>
				</tr>
				<tr>
					<td><input type="text" id="email" placeholder="joe.roberts@example.com"></td>
				</tr>
				<tr>
					<td class="error"><label id="emailError"></label></td>
				</tr>
					<tr><td id="button"><button onclick="sendEmail()" id="recoverButton">Recover Password</button></td>
				</tr>
			</tbody></table>
		</div>
	</body>
</html>
